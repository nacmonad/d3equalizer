<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  
  <title>D3 equalizer</title>
  <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
<style>
  #player{
    background:steelblue;
    margin-right:auto;
    width:176px;
  }

  #buttonGroup{
    float:center;
  }

</style>
  <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>
  <audio id ="audioElement" src="./audio/Tinkle.mp3"></audio>

  <div id ="player">
    <g id="buttonGroup">
       <button type ="button" class="btn btn-default btn-md button-play" onclick="document.getElementById('audioElement').play()"> <span class="glyphicon glyphicon-play"></span></button>
     <button type ="button" class="btn btn-default btn-md button-pause" onclick="document.getElementById('audioElement').pause()"><span class="glyphicon glyphicon-pause"></span></button>
     <button type ="button" class="btn btn-default btn-md button-volume-down" onclick="document.getElementById('audioElement').volume-=0.1"><span class="glyphicon glyphicon-volume-down"></span></button>
     <button type ="button" class="btn btn-default btn-md button-volume-up" onclick="document.getElementById('audioElement').volume+=0.1"><span class="glyphicon glyphicon-volume-up"></span></button>
    </g>
    <svg height = "0px">
    <defs>
        <filter id="filter-map" x="-0.15000001" y="-0.15000001" width="1.3" height="1.3" color-interpolation-filters="sRGB" >
            <feGaussianBlur stdDeviation="3" in="SourceGraphic" result="result4" id="feGaussianBlur4208" />
        </filter>
    </defs>
  </svg>
  </div>

  <script>
    var colorScale = d3.scale.linear()
            .domain([0,100,200])
            .range(["crimson","steelblue","chartreuse"]);
            //.range(["crimson", "chartreuse"]);

    $(document).ready(function () {
//header div transition     
d3.select("#player")
  .transition()
  .duration(1000)
  .style("width",$(window).width() + "px")
  .style("background-color","black");
//
  var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  var audioElement = document.getElementById('audioElement');
  var audioSrc = audioCtx.createMediaElementSource(audioElement);
  var analyser = audioCtx.createAnalyser();

  // Bind our analyser to the media element source.
  audioSrc.connect(analyser);
  audioSrc.connect(audioCtx.destination);

  //var frequencyData = new Uint8Array(analyser.frequencyBinCount);
  var frequencyData = new Uint8Array(200);

  var svgHeight = '300';
  var svgWidth = '1200';
  var barPadding = '1';

  function createSvg(parent, height, width) {
    return d3.select(parent).append('svg').attr('height', height).attr('width', width);
  }

  var svg = createSvg('body', svgHeight, svgWidth);

  // Create our initial D3 chart.
  svg.selectAll('circle')
     .data(frequencyData)
     .enter()
     .append('circle')
     .attr('id', function(d,i){ return 'circle'+i;})
     .attr('cx', function(d,i){return i*svgWidth/200;})
     .attr('cy', svgHeight/2)
     .attr('r', function(d,i){ return d; });

  // Continuously loop and update chart with frequency data.
  function renderChart() {
     requestAnimationFrame(renderChart);

     // Copy frequency data to frequencyData array.
     analyser.getByteFrequencyData(frequencyData);
       //console.log(frequencyData);

     // Update d3 chart with new data.
     svg.selectAll('circle')
        .data(frequencyData)
        .attr('r', function(d) {
           return d;
        })
        .attr('stroke-width', function(d) { return d;})
        .attr('stroke', function(d) {
           return colorScale(d);
        })
        .attr('filter', 'url(#filter-map)');
  }



  // Run the loop
  renderChart();

});
$(window).resize(function(){
//header div transition
d3.select("#player")
  .transition()
  .duration(1000)
  .style("width",$(window).width() + "px")
  .style("background-color","black");})
    </script>

</body>
</html>